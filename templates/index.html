<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Control de LEDs - Panel de Control</title>
    <meta
      name="description"
      content="Panel de control para gestionar LEDs por habitaciones con reconocimiento de voz"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#3b82f6",
              success: "#10b981",
              danger: "#ef4444",
              warning: "#f59e0b",
            },
          },
        },
      };
    </script>
  </head>
  <body
    class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen py-8 px-4"
  >
    <!-- Dashboard Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <div class="flex items-center">
            <div class="flex-shrink-0">
              <div
                class="inline-flex items-center justify-center w-10 h-10 bg-primary rounded-lg"
              >
                <svg
                  class="w-6 h-6 text-white"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"
                  ></path>
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M8 21l4-4 4 4M3 7l9-6 9 6"
                  ></path>
                </svg>
              </div>
            </div>
            <div class="ml-4">
              <h1 class="text-xl font-semibold text-gray-900">
                Panel de Control
              </h1>
              <p class="text-sm text-gray-500">Control inteligente del hogar</p>
            </div>
          </div>
          <div class="flex items-center space-x-4">
            <button
              id="toggleGuide"
              class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary"
            >
              <svg
                class="w-4 h-4 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                ></path>
              </svg>
              <span id="guideButtonText">Gu√≠a de Comandos</span>
            </button>
          </div>
        </div>
      </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Dashboard Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Environmental Metrics -->
        <div class="lg:col-span-1">
          <h2 class="text-lg font-medium text-gray-900 mb-4">
            M√©tricas Ambientales
          </h2>
          <div class="space-y-4">
            <!-- Temperature Card -->
            <div class="bg-white overflow-hidden shadow rounded-lg">
              <div class="p-6">
                <div class="flex items-center">
                  <div class="flex-shrink-0">
                    <div
                      class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center"
                    >
                      <svg
                        class="w-6 h-6 text-red-600"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                        ></path>
                      </svg>
                    </div>
                  </div>
                  <div class="ml-4 flex-1">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-sm font-medium text-gray-500">
                          Temperatura
                        </p>
                        <p class="text-2xl font-bold text-gray-900">
                          <span id="temp">--</span
                          ><span class="text-lg text-gray-500">¬∞C</span>
                        </p>
                      </div>
                      <div class="text-right">
                        <div
                          class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"
                        >
                          <svg
                            class="w-3 h-3 mr-1"
                            fill="currentColor"
                            viewBox="0 0 20 20"
                          >
                            <path
                              fill-rule="evenodd"
                              d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z"
                              clip-rule="evenodd"
                            ></path>
                          </svg>
                          Normal
                        </div>
                        <p class="text-xs text-gray-500 mt-1">
                          √öltima actualizaci√≥n: ahora
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="mt-4">
                  <div class="bg-gray-200 rounded-full h-2">
                    <div
                      class="bg-red-500 h-2 rounded-full"
                      style="width: 65%"
                    ></div>
                  </div>
                  <div class="flex justify-between text-xs text-gray-500 mt-1">
                    <span>0¬∞C</span>
                    <span>50¬∞C</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Humidity Card -->
            <div class="bg-white overflow-hidden shadow rounded-lg">
              <div class="p-6">
                <div class="flex items-center">
                  <div class="flex-shrink-0">
                    <div
                      class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"
                    >
                      <svg
                        class="w-6 h-6 text-blue-600"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"
                        ></path>
                      </svg>
                    </div>
                  </div>
                  <div class="ml-4 flex-1">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-sm font-medium text-gray-500">Humedad</p>
                        <p class="text-2xl font-bold text-gray-900">
                          <span id="hum">--</span
                          ><span class="text-lg text-gray-500">%</span>
                        </p>
                      </div>
                      <div class="text-right">
                        <div
                          class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
                        >
                          <svg
                            class="w-3 h-3 mr-1"
                            fill="currentColor"
                            viewBox="0 0 20 20"
                          >
                            <path
                              fill-rule="evenodd"
                              d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                              clip-rule="evenodd"
                            ></path>
                          </svg>
                          √ìptima
                        </div>
                        <p class="text-xs text-gray-500 mt-1">
                          √öltima actualizaci√≥n: ahora
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="mt-4">
                  <div class="bg-gray-200 rounded-full h-2">
                    <div
                      class="bg-blue-500 h-2 rounded-full"
                      style="width: 45%"
                    ></div>
                  </div>
                  <div class="flex justify-between text-xs text-gray-500 mt-1">
                    <span>0%</span>
                    <span>100%</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Voice Control Card -->
            <div class="bg-white overflow-hidden shadow rounded-lg">
              <div class="p-6">
                <h3
                  class="text-lg font-medium text-gray-900 mb-4 flex items-center"
                >
                  <svg
                    class="w-5 h-5 mr-2 text-primary"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"
                    ></path>
                  </svg>
                  Control por Voz
                </h3>
                <div class="text-center space-y-4">
                  <button
                    id="vozBtn"
                    class="w-full inline-flex items-center justify-center bg-primary hover:bg-blue-700 active:bg-blue-800 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                  >
                    <svg
                      class="w-5 h-5 mr-2"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"
                      ></path>
                    </svg>
                    Activar Reconocimiento
                  </button>
                  <div
                    id="vozTexto"
                    class="min-h-[3rem] p-3 bg-gray-50 rounded-lg border border-gray-200 text-sm"
                    role="status"
                    aria-live="polite"
                  >
                    <span class="text-gray-500 italic"
                      >Presiona el bot√≥n para comenzar a hablar...</span
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- Status Message -->
            <div class="mt-8">
              <div
                id="mensaje"
                class="bg-white shadow rounded-lg p-4 text-center font-semibold min-h-[3rem] flex items-center justify-center"
                role="status"
                aria-live="polite"
              >
                <span class="text-gray-500"
                  >Sistema listo para recibir comandos</span
                >
              </div>
            </div>
          </div>
        </div>

        <!-- Device Controls -->
        <div class="lg:col-span-2">
          <h2 class="text-lg font-medium text-gray-900 mb-4">
            Control de Dispositivos
          </h2>

          <!-- Room Controls -->
          <div class="bg-white shadow rounded-lg mb-6">
            <div class="px-6 py-4 border-b border-gray-200">
              <h3 class="text-lg font-medium text-gray-900 flex items-center">
                <span class="w-2 h-2 bg-primary rounded-full mr-3"></span>
                Control de Habitaciones
              </h3>
            </div>
            <div class="p-6">
              <form
                id="controlForm"
                class="grid grid-cols-1 md:grid-cols-2 gap-6"
              >
                <!-- Cuarto -->
                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                  <div class="flex items-center mb-4">
                    <svg
                      class="w-5 h-5 mr-2 text-gray-600"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"
                      ></path>
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M8 21l4-4 4 4M3 7l9-6 9 6"
                      ></path>
                    </svg>
                    <h4 class="font-semibold text-gray-700">Cuarto</h4>
                  </div>
                  <div class="flex gap-3">
                    <button
                      type="button"
                      data-comando="encender_cuarto"
                      class="flex-1 bg-success hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200"
                    >
                      Encender
                    </button>
                    <button
                      type="button"
                      data-comando="apagar_cuarto"
                      class="flex-1 bg-danger hover:bg-red-600 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200"
                    >
                      Apagar
                    </button>
                  </div>
                </div>

                <!-- Sala -->
                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                  <div class="flex items-center mb-4">
                    <svg
                      class="w-5 h-5 mr-2 text-gray-600"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2"
                      ></path>
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M5 4h14l-1 14H6L5 4z"
                      ></path>
                    </svg>
                    <h4 class="font-semibold text-gray-700">Sala</h4>
                  </div>
                  <div class="flex gap-3">
                    <button
                      type="button"
                      data-comando="encender_sala"
                      class="flex-1 bg-success hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200"
                    >
                      Encender
                    </button>
                    <button
                      type="button"
                      data-comando="apagar_sala"
                      class="flex-1 bg-danger hover:bg-red-600 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200"
                    >
                      Apagar
                    </button>
                  </div>
                </div>

                <!-- Cocina -->
                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                  <div class="flex items-center mb-4">
                    <svg
                      class="w-5 h-5 mr-2 text-gray-600"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                      ></path>
                    </svg>
                    <h4 class="font-semibold text-gray-700">Cocina</h4>
                  </div>
                  <div class="flex gap-3">
                    <button
                      type="button"
                      data-comando="encender_cocina"
                      class="flex-1 bg-success hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200"
                    >
                      Encender
                    </button>
                    <button
                      type="button"
                      data-comando="apagar_cocina"
                      class="flex-1 bg-danger hover:bg-red-600 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200"
                    >
                      Apagar
                    </button>
                  </div>
                </div>

                <!-- Ventilador -->
                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                  <div class="flex items-center mb-4">
                    <svg
                      class="w-5 h-5 mr-2 text-gray-600"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 4v16m8-8H4"
                      ></path>
                    </svg>
                    <h4 class="font-semibold text-gray-700">Ventilador</h4>
                  </div>
                  <div class="flex gap-3">
                    <button
                      type="button"
                      data-comando="encender_ventilador"
                      class="flex-1 bg-success hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200"
                    >
                      Encender
                    </button>
                    <button
                      type="button"
                      data-comando="apagar_ventilador"
                      class="flex-1 bg-danger hover:bg-red-600 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200"
                    >
                      Apagar
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>

          <!-- Intensity Controls -->
          <div class="bg-white shadow rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
              <h3 class="text-lg font-medium text-gray-900 flex items-center">
                <span class="w-2 h-2 bg-warning rounded-full mr-3"></span>
                Control de Intensidad
              </h3>
            </div>
            <div class="p-6">
              <form id="intensidadForm" class="space-y-6">
                <!-- Cuarto Intensity -->
                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                  <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 640 512"
                        height="30"
                        width="30"
                        class="mr-2"
                      >
                        <!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                        <path
                          d="M32 32c17.7 0 32 14.3 32 32l0 256 224 0 0-160c0-17.7 14.3-32 32-32l224 0c53 0 96 43 96 96l0 224c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-32-224 0-32 0L64 416l0 32c0 17.7-14.3 32-32 32s-32-14.3-32-32L0 64C0 46.3 14.3 32 32 32zm144 96a80 80 0 1 1 0 160 80 80 0 1 1 0-160z"
                        />
                      </svg>
                      <h4 class="font-semibold text-gray-700">
                        Intensidad del Cuarto
                      </h4>
                    </div>
                    <output
                      for="intensidad_cuarto"
                      id="valor_cuarto"
                      class="text-sm font-bold text-primary bg-blue-50 px-3 py-1 rounded-full"
                    >
                      M√°ximo
                    </output>
                  </div>
                  <input
                    type="range"
                    min="1"
                    max="5"
                    step="1"
                    id="intensidad_cuarto"
                    name="intensidad_cuarto"
                    value="5"
                    class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                    oninput="enviarIntensidad('intensidad_cuarto')"
                  />
                  <div class="flex justify-between text-xs text-gray-500 mt-2">
                    <span>M√≠nimo</span>
                    <span>Bajo</span>
                    <span>Medio</span>
                    <span>Alto</span>
                    <span>M√°ximo</span>
                  </div>
                </div>

                <!-- Sala Intensity -->
                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                  <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 640 512"
                        height="30"
                        width="30"
                        class="mr-2"
                      >
                        <!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                        <path
                          d="M64 160C64 89.3 121.3 32 192 32l256 0c70.7 0 128 57.3 128 128l0 33.6c-36.5 7.4-64 39.7-64 78.4l0 48-384 0 0-48c0-38.7-27.5-71-64-78.4L64 160zM544 272c0-20.9 13.4-38.7 32-45.3c5-1.8 10.4-2.7 16-2.7c26.5 0 48 21.5 48 48l0 176c0 17.7-14.3 32-32 32l-32 0c-17.7 0-32-14.3-32-32L96 448c0 17.7-14.3 32-32 32l-32 0c-17.7 0-32-14.3-32-32L0 272c0-26.5 21.5-48 48-48c5.6 0 11 1 16 2.7c18.6 6.6 32 24.4 32 45.3l0 48 0 32 32 0 384 0 32 0 0-32 0-48z"
                        />
                      </svg>
                      <h4 class="font-semibold text-gray-700">
                        Intensidad de la Sala
                      </h4>
                    </div>
                    <output
                      for="intensidad_sala"
                      id="valor_sala"
                      class="text-sm font-bold text-primary bg-blue-50 px-3 py-1 rounded-full"
                    >
                      M√°ximo
                    </output>
                  </div>
                  <input
                    type="range"
                    min="1"
                    max="5"
                    step="1"
                    id="intensidad_sala"
                    name="intensidad_sala"
                    value="5"
                    class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                    oninput="enviarIntensidad('intensidad_sala')"
                  />
                  <div class="flex justify-between text-xs text-gray-500 mt-2">
                    <span>M√≠nimo</span>
                    <span>Bajo</span>
                    <span>Medio</span>
                    <span>Alto</span>
                    <span>M√°ximo</span>
                  </div>
                </div>

                <!-- Cocina Intensity -->
                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                  <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 576 512"
                        height="30"
                        width="30"
                        class="mr-2"
                      >
                        <!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                        <path
                          d="M240 144A96 96 0 1 0 48 144a96 96 0 1 0 192 0zm44.4 32C269.9 240.1 212.5 288 144 288C64.5 288 0 223.5 0 144S64.5 0 144 0c68.5 0 125.9 47.9 140.4 112l71.8 0c8.8-9.8 21.6-16 35.8-16l104 0c26.5 0 48 21.5 48 48s-21.5 48-48 48l-104 0c-14.2 0-27-6.2-35.8-16l-71.8 0zM144 80a64 64 0 1 1 0 128 64 64 0 1 1 0-128zM400 240c13.3 0 24 10.7 24 24l0 8 96 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-240 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l96 0 0-8c0-13.3 10.7-24 24-24zM288 464l0-112 224 0 0 112c0 26.5-21.5 48-48 48l-128 0c-26.5 0-48-21.5-48-48zM48 320l80 0 16 0 32 0c26.5 0 48 21.5 48 48s-21.5 48-48 48l-16 0c0 17.7-14.3 32-32 32l-64 0c-17.7 0-32-14.3-32-32l0-80c0-8.8 7.2-16 16-16zm128 64c8.8 0 16-7.2 16-16s-7.2-16-16-16l-16 0 0 32 16 0zM24 464l176 0c13.3 0 24 10.7 24 24s-10.7 24-24 24L24 512c-13.3 0-24-10.7-24-24s10.7-24 24-24z"
                        />
                      </svg>
                      <h4 class="font-semibold text-gray-700">
                        Intensidad de la Cocina
                      </h4>
                    </div>
                    <output
                      for="intensidad_cocina"
                      id="valor_cocina"
                      class="text-sm font-bold text-primary bg-blue-50 px-3 py-1 rounded-full"
                    >
                      M√°ximo
                    </output>
                  </div>
                  <input
                    type="range"
                    min="1"
                    max="5"
                    step="1"
                    id="intensidad_cocina"
                    name="intensidad_cocina"
                    value="5"
                    class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                    oninput="enviarIntensidad('intensidad_cocina')"
                  />
                  <div class="flex justify-between text-xs text-gray-500 mt-2">
                    <span>M√≠nimo</span>
                    <span>Bajo</span>
                    <span>Medio</span>
                    <span>Alto</span>
                    <span>M√°ximo</span>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Voice Commands Guide Sidebar -->
    <aside
      id="guidePanel"
      class="fixed right-4 top-4 bottom-4 w-96 bg-blue-50 border border-blue-200 rounded-2xl p-6 transition-all duration-300 ease-in-out transform translate-x-full opacity-0 overflow-y-auto z-50 shadow-2xl"
      style="display: none"
    >
      <div class="flex items-center mb-6">
        <div
          class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center mr-3"
        >
          <svg
            class="w-4 h-4 text-white"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            ></path>
          </svg>
        </div>
        <h2 class="text-xl font-semibold text-blue-800 flex-1">
          Gu√≠a de Comandos de Voz
        </h2>
        <button
          id="closeGuide"
          class="text-blue-600 hover:text-blue-800 focus:outline-none"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            ></path>
          </svg>
        </button>
      </div>

      <div class="space-y-6">
        <!-- Important Note -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
          <div class="flex items-start">
            <svg
              class="w-5 h-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"
              ></path>
            </svg>
            <div>
              <h3 class="font-semibold text-yellow-800 mb-1">¬°Importante!</h3>
              <p class="text-sm text-yellow-700">
                Siempre debes decir <strong>"jarvis"</strong> antes de cada
                comando para que el sistema te reconozca.
              </p>
            </div>
          </div>
        </div>

        <!-- On/Off Commands -->
        <div class="bg-white rounded-lg p-4 border border-gray-200">
          <h3 class="font-semibold text-gray-800 mb-3 flex items-center">
            <svg
              class="w-4 h-4 mr-2 text-green-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 10V3L4 14h7v7l9-11h-7z"
              ></path>
            </svg>
            Encender y Apagar Luces
          </h3>
          <div class="grid gap-2 text-sm">
            <div class="flex items-center p-2 bg-green-50 rounded">
              <span class="font-mono text-green-700"
                >"jarvis, encender luz del cuarto"</span
              >
            </div>
            <div class="flex items-center p-2 bg-red-50 rounded">
              <span class="font-mono text-red-700"
                >"jarvis, apagar luz del cuarto"</span
              >
            </div>
            <div class="flex items-center p-2 bg-green-50 rounded">
              <span class="font-mono text-green-700"
                >"jarvis, encender luz de la sala"</span
              >
            </div>
            <div class="flex items-center p-2 bg-red-50 rounded">
              <span class="font-mono text-red-700"
                >"jarvis, apagar luz de la sala"</span
              >
            </div>
            <div class="flex items-center p-2 bg-green-50 rounded">
              <span class="font-mono text-green-700"
                >"jarvis, encender luz de la cocina"</span
              >
            </div>
            <div class="flex items-center p-2 bg-red-50 rounded">
              <span class="font-mono text-red-700"
                >"jarvis, apagar luz de la cocina"</span
              >
            </div>
          </div>
        </div>

        <!-- Intensity Commands -->
        <div class="bg-white rounded-lg p-4 border border-gray-200">
          <h3 class="font-semibold text-gray-800 mb-3 flex items-center">
            <svg
              class="w-4 h-4 mr-2 text-orange-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
              ></path>
            </svg>
            Control de Intensidad (Niveles 1-5)
          </h3>
          <div class="space-y-3">
            <div class="border-l-4 border-blue-400 pl-3">
              <h4 class="font-medium text-gray-700 mb-2">Cuarto:</h4>
              <div class="grid gap-1 text-sm">
                <span class="font-mono text-blue-700"
                  >"jarvis, intensidad del cuarto nivel 1"</span
                >
                <span class="font-mono text-blue-700"
                  >"jarvis, intensidad del cuarto nivel 3"</span
                >
                <span class="font-mono text-blue-700"
                  >"jarvis, intensidad del cuarto nivel 5"</span
                >
              </div>
            </div>
            <div class="border-l-4 border-purple-400 pl-3">
              <h4 class="font-medium text-gray-700 mb-2">Sala:</h4>
              <div class="grid gap-1 text-sm">
                <span class="font-mono text-purple-700"
                  >"jarvis, intensidad de la sala nivel 2"</span
                >
                <span class="font-mono text-purple-700"
                  >"jarvis, intensidad de la sala nivel 4"</span
                >
              </div>
            </div>
            <div class="border-l-4 border-orange-400 pl-3">
              <h4 class="font-medium text-gray-700 mb-2">Cocina:</h4>
              <div class="grid gap-1 text-sm">
                <span class="font-mono text-orange-700"
                  >"jarvis, intensidad de la cocina nivel 1"</span
                >
                <span class="font-mono text-orange-700"
                  >"jarvis, intensidad de la cocina nivel 5"</span
                >
              </div>
            </div>
            <div class="flex items-center p-2 bg-green-50 rounded">
              <span class="font-mono text-green-700"
                >"jarvis, encender ventilador"</span
              >
            </div>
            <div class="flex items-center p-2 bg-red-50 rounded">
              <span class="font-mono text-red-700"
                >"jarvis, apagar ventilador"</span
              >
            </div>
          </div>
        </div>

        <!-- Tips -->
        <div class="bg-white rounded-lg p-4 border border-gray-200">
          <h3 class="font-semibold text-gray-800 mb-3 flex items-center">
            <svg
              class="w-4 h-4 mr-2 text-blue-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
              ></path>
            </svg>
            Consejos de Uso
          </h3>
          <ul class="space-y-2 text-sm text-gray-600">
            <li class="flex items-start">
              <span
                class="w-2 h-2 bg-blue-400 rounded-full mt-2 mr-2 flex-shrink-0"
              ></span>
              Habla de forma clara y pausada
            </li>
            <li class="flex items-start">
              <span
                class="w-2 h-2 bg-blue-400 rounded-full mt-2 mr-2 flex-shrink-0"
              ></span>
              Espera a que aparezca el texto antes del siguiente comando
            </li>
            <li class="flex items-start">
              <span
                class="w-2 h-2 bg-blue-400 rounded-full mt-2 mr-2 flex-shrink-0"
              ></span>
              Si no funciona, intenta repetir el comando
            </li>
            <li class="flex items-start">
              <span
                class="w-2 h-2 bg-blue-400 rounded-full mt-2 mr-2 flex-shrink-0"
              ></span>
              Los niveles de intensidad van del 1 (m√≠nimo) al 5 (m√°ximo)
            </li>
          </ul>
        </div>
      </div>
    </aside>

    <!-- Overlay for mobile -->
    <div
      id="overlay"
      class="fixed inset-0 bg-black bg-opacity-50 z-40 transition-opacity duration-300 opacity-0 pointer-events-none"
    ></div>

    <style>
      /* Custom slider styles */
      .slider::-webkit-slider-thumb {
        appearance: none;
        height: 20px;
        width: 20px;
        border-radius: 50%;
        background: #3b82f6;
        cursor: pointer;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .slider::-moz-range-thumb {
        height: 20px;
        width: 20px;
        border-radius: 50%;
        background: #3b82f6;
        cursor: pointer;
        border: none;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      /* Animation for guide panel */
      #guidePanel.show {
        display: block !important;
        transform: translateX(0);
        opacity: 1;
      }

      #overlay.show {
        opacity: 1;
        pointer-events: auto;
      }
    </style>

    <script>
      // Aqu√≠ ir√≠an todas las funciones JavaScript originales
      // (enviarIntensidad, control de voz, etc.)
      // Las mantengo igual que en tu c√≥digo original

      // Toggle guide panel
      document
        .getElementById("toggleGuide")
        .addEventListener("click", function () {
          const panel = document.getElementById("guidePanel");
          const overlay = document.getElementById("overlay");
          const buttonText = document.getElementById("guideButtonText");

          if (panel.classList.contains("show")) {
            panel.classList.remove("show");
            overlay.classList.remove("show");
            buttonText.textContent = "Gu√≠a de Comandos";
          } else {
            panel.style.display = "block";
            setTimeout(() => {
              panel.classList.add("show");
              overlay.classList.add("show");
            }, 10);
            buttonText.textContent = "Ocultar Gu√≠a";
          }
        });

      document
        .getElementById("closeGuide")
        .addEventListener("click", function () {
          const panel = document.getElementById("guidePanel");
          const overlay = document.getElementById("overlay");
          const buttonText = document.getElementById("guideButtonText");

          panel.classList.remove("show");
          overlay.classList.remove("show");
          buttonText.textContent = "Gu√≠a de Comandos";
        });

      // Close guide when clicking overlay
      document.getElementById("overlay").addEventListener("click", function () {
        document.getElementById("closeGuide").click();
      });
    </script>

    <script>
      setInterval(async () => {
        try {
          const resp = await fetch("/sensor");
          const data = await resp.json();
          if (data.temperatura !== undefined && data.humedad !== undefined) {
            document.getElementById("temp").textContent = data.temperatura;
            document.getElementById("hum").textContent = data.humedad;
          }
        } catch (e) {
          document.getElementById("temp").textContent = "--";
          document.getElementById("hum").textContent = "--";
        }
      }, 2000);
      // Botones manuales
      const buttons = document.querySelectorAll("button[data-comando]");
      const mensaje = document.getElementById("mensaje");

      window.onload = function () {
        document.getElementById("valor_led1").innerText =
          document.getElementById("intensidad_led1").value;
        document.getElementById("valor_sala").innerText =
          document.getElementById("intensidad_sala").value;
        document.getElementById("valor_cocina").innerText =
          document.getElementById("intensidad_cocina").value;
      };

      buttons.forEach((btn) => {
        btn.addEventListener("click", async () => {
          const comando = btn.getAttribute("data-comando");
          await enviarComando(comando);
        });
      });

      function enviarIntensidad(comando) {
        const nivel = document.getElementById(comando).value;
        const intensidad = nivelAIntensidad(nivel);
        // Cambia el id del output seg√∫n el comando
        let outputId = "";
        if (comando === "intensidad_cuarto") outputId = "valor_cuarto";
        else if (comando === "intensidad_sala") outputId = "valor_sala";
        else if (comando === "intensidad_cocina") outputId = "valor_cocina";
        if (outputId) document.getElementById(outputId).innerText = nivel;
        fetch("/accion", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: `comando=${comando}&intensidad=${intensidad}`,
        });
      }

      // ...existing code...
      async function enviarIntensidadVoz(comando, intensidad) {
        // Cambia el id del output y slider seg√∫n el comando
        let outputId = "";
        let sliderId = "";
        let nivel = 1;
        if (comando === "intensidad_cuarto") {
          outputId = "valor_cuarto";
          sliderId = "intensidad_cuarto";
        } else if (comando === "intensidad_sala") {
          outputId = "valor_sala";
          sliderId = "intensidad_sala";
        } else if (comando === "intensidad_cocina") {
          outputId = "valor_cocina";
          sliderId = "intensidad_cocina";
        }
        // Calcula el nivel (1-5) a partir del valor PWM recibido
        if (intensidad == 51) nivel = 1;
        else if (intensidad == 102) nivel = 2;
        else if (intensidad == 153) nivel = 3;
        else if (intensidad == 204) nivel = 4;
        else if (intensidad == 255) nivel = 5;

        if (outputId) document.getElementById(outputId).innerText = nivel;
        if (sliderId) document.getElementById(sliderId).value = nivel;

        await fetch("/accion", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: `comando=${comando}&intensidad=${intensidad}`,
        });
        mensaje.textContent = `‚úÖ Intensidad enviada: ${intensidad} (${comando})`;
        mensaje.className = "mt-6 text-center text-green-600 font-semibold";
      }
      // ...existing code...

      function nivelAIntensidad(nivel) {
        // 1 = 51, 2 = 102, 3 = 153, 4 = 204, 5 = 255
        const niveles = [0, 51, 102, 153, 204, 255];
        nivel = Math.max(1, Math.min(5, parseInt(nivel)));
        return niveles[nivel];
      }

      async function enviarComando(comando) {
        try {
          const response = await fetch("/accion", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams({ comando }),
          });

          if (response.ok) {
            mensaje.textContent = "‚úÖ Comando enviado: " + comando;
            mensaje.className = "mt-6 text-center text-green-600 font-semibold";
          } else {
            mensaje.textContent = "‚ùå Error al enviar comando.";
            mensaje.className = "mt-6 text-center text-red-600 font-semibold";
          }
        } catch (error) {
          mensaje.textContent = "‚ùå Error de conexi√≥n con el servidor.";
          mensaje.className = "mt-6 text-center text-red-600 font-semibold";
        }
      }

      // Reconocimiento de voz
      const vozBtn = document.getElementById("vozBtn");
      const vozTexto = document.getElementById("vozTexto");
      // ...existing code...

      let recognition;
      let escuchandoComando = false;

      if (
        "webkitSpeechRecognition" in window ||
        "SpeechRecognition" in window
      ) {
        const SpeechRecognition =
          window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.lang = "es-ES";
        recognition.continuous = true; // Escucha continua

        recognition.onresult = async function (event) {
          // Toma siempre el √∫ltimo resultado reconocido
          const texto =
            event.results[event.results.length - 1][0].transcript.toLowerCase();
          vozTexto.textContent = 'Escuchado: "' + texto + '"';

          // ...dentro de recognition.onresult...
          if (!escuchandoComando) {
            if (texto.includes("jarvis")) {
              escuchandoComando = true;
              mensaje.textContent = "üîä Dime tu comando...";
              mensaje.className =
                "mt-6 text-center text-blue-600 font-semibold";
            }
          } else {
            // Encender/apagar por nombre
            // ...dentro de recognition.onresult...
            if (texto.includes("encender luz del cuarto"))
              await enviarComando("encender_cuarto");
            else if (texto.includes("apagar luz del cuarto"))
              await enviarComando("apagar_cuarto");
            else if (texto.includes("encender luz de la sala"))
              await enviarComando("encender_sala");
            else if (texto.includes("apagar luz de la sala"))
              await enviarComando("apagar_sala");
            else if (texto.includes("encender luz de la cocina"))
              await enviarComando("encender_cocina");
            else if (texto.includes("apagar luz de la cocina"))
              await enviarComando("apagar_cocina");
            else if (texto.includes("encender ventilador"))
              await enviarComando("encender_ventilador");
            else if (texto.includes("apagar ventilador"))
              await enviarComando("apagar_ventilador");
            // Intensidad por nombre y nivel
            else if (texto.match(/intensidad.*cuarto.*nivel (\d)/)) {
              const match = texto.match(/intensidad.*cuarto.*nivel (\d)/);
              const nivel = match[1];
              const intensidad = nivelAIntensidad(nivel);
              await enviarIntensidadVoz("intensidad_cuarto", intensidad);
            } else if (texto.match(/intensidad.*sala.*nivel (\d)/)) {
              const match = texto.match(/intensidad.*sala.*nivel (\d)/);
              const nivel = match[1];
              const intensidad = nivelAIntensidad(nivel);
              await enviarIntensidadVoz("intensidad_sala", intensidad);
            } else if (texto.match(/intensidad.*cocina.*nivel (\d)/)) {
              const match = texto.match(/intensidad.*cocina.*nivel (\d)/);
              const nivel = match[1];
              const intensidad = nivelAIntensidad(nivel);
              await enviarIntensidadVoz("intensidad_cocina", intensidad);
            } else {
              mensaje.textContent = "‚ùå Comando de voz no reconocido.";
              mensaje.className = "mt-6 text-center text-red-600 font-semibold";
            }
            escuchandoComando = false;
            mensaje.textContent += " (Di 'jarvis' para otro comando)";
          }
        };

        recognition.onerror = function (event) {
          vozTexto.textContent = "Error: " + event.error;
          recognition.stop();
          setTimeout(() => recognition.start(), 1000);
        };

        // Inicia autom√°ticamente
        recognition.start();
        vozTexto.textContent = "üéôÔ∏è Diga 'jarvis' para dar un comando...";
        // ...despu√©s de definir recognition...
        vozBtn.disabled = false;
        vozBtn.classList.remove("bg-gray-400", "cursor-not-allowed");

        vozBtn.addEventListener("click", () => {
          recognition.start();
          vozTexto.textContent = "üéôÔ∏è Escuchando...";
        });

        // Reinicia autom√°ticamente si se detiene
        recognition.onend = function () {
          vozTexto.textContent =
            "üé§ Micr√≥fono detenido. Pulsa el bot√≥n para reactivar.";
          vozBtn.disabled = false;
          vozBtn.classList.remove("bg-gray-400", "cursor-not-allowed");
        };
        recognition.onerror = function (event) {
          vozTexto.textContent = "Error: " + event.error;
          recognition.stop();
          vozBtn.disabled = false;
          vozBtn.classList.remove("bg-gray-400", "cursor-not-allowed");
        };
      } else {
        vozTexto.textContent =
          "‚ö†Ô∏è Tu navegador no soporta reconocimiento de voz.";
        vozBtn.disabled = true;
        vozBtn.classList.add("bg-gray-400", "cursor-not-allowed");
      }
    </script>
  </body>
</html>
